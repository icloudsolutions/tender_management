<odoo>
    <record id="res_config_settings_view_form_etimad" model="ir.ui.view">
        <field name="name">res.config.settings.etimad.form</field>
        <field name="model">res.config.settings</field>
        <field name="priority">90</field>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="inside">
                <app string="Etimad Tenders" name="ics_etimad_tenders_crm" groups="base.group_system">
                    
                    <!-- Scraping & Sync Settings -->
                    <block title="Scraping &amp; Synchronization" name="etimad_scraping_settings">
                        <setting id="etimad_auto_sync_setting" help="Automatically fetch new tenders from Etimad platform">
                            <field name="etimad_auto_sync"/>
                            <div class="content-group" invisible="not etimad_auto_sync">
                                <div class="alert alert-info mt16" role="status">
                                    <i class="fa fa-info-circle" title="Information"/> These settings control how often and how many tenders are fetched from Etimad portal.
                                    Changes will be applied to the scheduled sync job immediately after saving.
                                </div>
                                <div class="row mt16">
                                    <label for="etimad_sync_interval" class="col-lg-3 o_light_label" string="Sync Interval"/>
                                    <field name="etimad_sync_interval" class="oe_inline"/>
                                    <span class="ml-2">hours</span>
                                    <div class="text-muted ml-2">(Recommended: 24 hours for daily sync)</div>
                                </div>
                                <div class="row mt8">
                                    <label for="etimad_fetch_page_size" class="col-lg-3 o_light_label" string="Tenders per Page"/>
                                    <field name="etimad_fetch_page_size" class="oe_inline"/>
                                    <span class="ml-2 text-muted">(Min: 10, Max: 50 - Etimad API limit)</span>
                                </div>
                                <div class="row mt8">
                                    <label for="etimad_fetch_pages" class="col-lg-3 o_light_label" string="Pages per Sync"/>
                                    <field name="etimad_fetch_pages" class="oe_inline"/>
                                    <div class="text-muted ml-2">
                                        Total tenders per sync = Page Size × Pages
                                        <br/><small>Example: 50 × 3 = 150 tenders</small>
                                    </div>
                                </div>
                                <div class="row mt8">
                                    <label for="etimad_max_retries" class="col-lg-3 o_light_label" string="Max Retries"/>
                                    <field name="etimad_max_retries" class="oe_inline"/>
                                    <span class="ml-2 text-muted">(If scraping fails, retry this many times)</span>
                                </div>
                            </div>
                            <div class="content-group" invisible="etimad_auto_sync">
                                <div class="alert alert-warning mt16" role="status">
                                    <i class="fa fa-exclamation-triangle" title="Warning"/> Auto sync is disabled. Tenders must be fetched manually using the "Manual Sync Now" button below.
                                </div>
                            </div>
                        </setting>
                        
                        <setting id="etimad_test_connection">
                            <button name="action_test_scraping" 
                                    string="Test Connection" 
                                    type="object" 
                                    class="btn-secondary"
                                    icon="fa-plug"
                                    help="Fetch 5 tenders to test Etimad API connection"/>
                            <button name="action_manual_sync" 
                                    string="Manual Sync Now" 
                                    type="object" 
                                    class="btn-primary ml-2"
                                    icon="fa-refresh"
                                    help="Manually trigger tender synchronization with current settings"/>
                        </setting>
                    </block>
                    
                    <!-- Smart Matching Settings -->
                    <block title="Smart Matching Configuration" name="etimad_matching_settings">
                        <setting id="etimad_matching_enable" help="Calculate matching scores based on your company profile. If you see 'invalid fields: Document, Spreadsheet, Folder', use: Etimad Tenders → Configuration → Smart Matching (Preferred Activities) instead.">
                            <field name="etimad_enable_matching"/>
                            <div class="content-group" invisible="not etimad_enable_matching">
                                <div class="row mt16">
                                    <label for="etimad_preferred_activities_ids" class="col-lg-3 o_light_label" string="Preferred Activities"/>
                                    <field name="etimad_preferred_activities_ids" 
                                           widget="many2many_tags" 
                                           options="{'color_field': 'color', 'no_create': True}"
                                           class="o_field_many2many_tags"
                                           placeholder="Select activities from Etimad classification..."/>
                                </div>
                                <div class="row mt16">
                                    <label for="etimad_preferred_categories" class="col-lg-3 o_light_label" string="Primary Business"/>
                                    <field name="etimad_preferred_categories" 
                                           placeholder="supply, maintenance, services"
                                           class="o_field_char"/>
                                    <div class="text-muted ml-2">
                                        Options: supply, services, construction, maintenance, consulting
                                    </div>
                                </div>
                                <div class="row mt16">
                                    <label for="etimad_preferred_agencies" class="col-lg-3 o_light_label" string="Preferred Agencies"/>
                                    <field name="etimad_preferred_agencies" 
                                           placeholder="Ministry of Health, General Authority for Transport, Saudi Aramco"
                                           class="o_field_char"/>
                                </div>
                            </div>
                        </setting>
                        
                        <setting id="etimad_preparation_time" help="Minimum days needed to prepare tender submissions">
                            <label for="etimad_min_preparation_days" string="Min Preparation Days"/>
                            <field name="etimad_min_preparation_days" class="oe_inline"/>
                        </setting>
                        
                        <setting id="etimad_recalc_scores">
                            <button name="action_recalculate_match_scores" 
                                    string="Recalculate All Match Scores"
                                    icon="fa-refresh" 
                                    type="object" 
                                    class="btn-secondary"/>
                        </setting>
                    </block>
                    
                    <!-- Auto Opportunity Creation -->
                    <block title="Auto Opportunity Creation" name="etimad_opportunity_settings">
                        <setting id="etimad_auto_opportunity" title="Automatically create CRM opportunities for new tenders" help="Enable to create opportunities when tenders match criteria">
                            <field name="etimad_auto_create_opportunity"/>
                            <div class="content-group" invisible="not etimad_auto_create_opportunity">
                                <div class="row mt16">
                                    <label for="etimad_min_tender_value" class="col-lg-3 o_light_label" string="Min Value (SAR)"/>
                                    <field name="etimad_min_tender_value" class="oe_inline"/>
                                </div>
                                <div class="row mt8">
                                    <label for="etimad_min_match_score" class="col-lg-3 o_light_label" string="Min Match Score"/>
                                    <field name="etimad_min_match_score" class="oe_inline"/>
                                    <span class="ml-2">%</span>
                                </div>
                                <div class="row mt8">
                                    <label for="etimad_auto_assign_salesperson" class="col-lg-3 o_light_label"/>
                                    <field name="etimad_auto_assign_salesperson"/>
                                    <span class="ml-2">Auto Assign Salesperson</span>
                                </div>
                            </div>
                        </setting>
                    </block>
                    
                    <!-- Auto Fetch Details -->
                    <block title="Auto Fetch Details" name="etimad_fetch_details_settings">
                        <setting id="etimad_auto_fetch" help="Automatically fetch detailed information for high-match tenders">
                            <field name="etimad_auto_fetch_details"/>
                            <div class="content-group" invisible="not etimad_auto_fetch_details">
                                <div class="row mt16">
                                    <label for="etimad_fetch_details_threshold" class="col-lg-3 o_light_label" string="Fetch if Match Score ≥"/>
                                    <field name="etimad_fetch_details_threshold" class="oe_inline"/>
                                    <span class="ml-2">%</span>
                                </div>
                            </div>
                        </setting>
                    </block>
                    
                    <!-- Notification Settings -->
                    <block title="Notification Settings" name="etimad_notification_settings">
                        <setting id="etimad_notifications" help="Configure when and who receives tender notifications">
                            <field name="etimad_notify_new_tenders"/>
                            <label for="etimad_notify_new_tenders" string="Notify on New Tenders"/>
                        </setting>
                        <setting id="etimad_notify_high_match">
                            <field name="etimad_notify_high_match"/>
                            <label for="etimad_notify_high_match" string="Notify High Match Tenders (≥70%)"/>
                        </setting>
                        <setting id="etimad_notify_hot">
                            <field name="etimad_notify_hot_tenders"/>
                            <label for="etimad_notify_hot_tenders" string="Notify Hot Tenders (High Value + Urgent)"/>
                        </setting>
                        <setting id="etimad_notify_urgent">
                            <field name="etimad_notify_urgent_deadlines"/>
                            <label for="etimad_notify_urgent_deadlines" string="Notify Urgent Deadlines (≤3 days)"/>
                        </setting>
                        <setting id="etimad_notification_users" string="Notification Recipients" help="Users who will receive tender notifications">
                            <field name="etimad_notification_user_ids" widget="many2many_tags"/>
                        </setting>
                    </block>
                    
                    <!-- Archive Settings -->
                    <block title="Archive Settings" name="etimad_archive_settings">
                        <setting id="etimad_archive" help="Automatically archive old closed tenders to keep your data clean">
                            <field name="etimad_auto_archive"/>
                            <div class="content-group" invisible="not etimad_auto_archive">
                                <div class="row mt16">
                                    <label for="etimad_archive_days" class="col-lg-3 o_light_label" string="Archive after"/>
                                    <field name="etimad_archive_days" class="oe_inline"/>
                                    <span class="ml-2">days after deadline</span>
                                </div>
                                <div class="row mt8">
                                    <label for="etimad_archive_lost_only" class="col-lg-3 o_light_label"/>
                                    <field name="etimad_archive_lost_only"/>
                                    <span class="ml-2">Archive Lost/Cancelled Only</span>
                                </div>
                            </div>
                        </setting>
                    </block>
                    
                </app>
            </xpath>
        </field>
    </record>
</odoo>