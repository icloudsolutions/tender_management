<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_etimad_config_wizard_form" model="ir.ui.view">
        <field name="name">ics.etimad.config.wizard.form</field>
        <field name="model">ics.etimad.config.wizard</field>
        <field name="arch" type="xml">
            <form string="Etimad Tenders Configuration">
                <sheet>
                    <div class="oe_title mb-3">
                        <h1>Etimad Tenders Configuration</h1>
                    </div>

                    <notebook>
                        <!-- Tab 1: Scraping & Sync -->
                        <page string="Scraping &amp; Sync" name="scraping">
                            <group>
                                <group string="Auto Synchronization">
                                    <field name="etimad_auto_sync"/>
                                    <field name="etimad_sync_interval" invisible="not etimad_auto_sync"/>
                                    <field name="etimad_fetch_page_size" invisible="not etimad_auto_sync"/>
                                    <field name="etimad_fetch_pages" invisible="not etimad_auto_sync"/>
                                    <field name="etimad_publish_date_filter"/>
                                    <field name="etimad_max_retries" invisible="not etimad_auto_sync"/>
                                </group>
                                <group string="Manual Actions">
                                    <div>
                                        <button name="action_test_scraping"
                                                string="Test Connection"
                                                type="object"
                                                class="btn-secondary me-2"
                                                icon="fa-plug"/>
                                        <button name="action_manual_sync"
                                                string="Manual Sync Now"
                                                type="object"
                                                class="btn-primary"
                                                icon="fa-refresh"/>
                                    </div>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 2: Smart Matching -->
                        <page string="Smart Matching" name="matching">
                            <group>
                                <group string="Matching Settings">
                                    <field name="etimad_enable_matching"/>
                                    <field name="etimad_preferred_activities_ids"
                                           widget="many2many_tags"
                                           options="{'color_field': 'color', 'no_create': True}"
                                           invisible="not etimad_enable_matching"/>
                                    <field name="etimad_preferred_categories"
                                           placeholder="supply, maintenance, services"
                                           invisible="not etimad_enable_matching"/>
                                    <field name="etimad_preferred_agencies"
                                           placeholder="Ministry of Health, Saudi Aramco"
                                           invisible="not etimad_enable_matching"/>
                                    <field name="etimad_min_preparation_days"
                                           invisible="not etimad_enable_matching"/>
                                </group>
                                <group string="Actions">
                                    <div>
                                        <button name="action_recalculate_match_scores"
                                                string="Recalculate All Match Scores"
                                                type="object"
                                                class="btn-secondary me-2"
                                                icon="fa-refresh"/>
                                        <button name="action_open_matching_rules"
                                                string="Manage Dynamic Rules"
                                                type="object"
                                                class="btn-secondary"
                                                icon="fa-list-alt"/>
                                    </div>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 3: Auto Opportunity -->
                        <page string="Auto Opportunity" name="opportunity">
                            <group>
                                <group string="Opportunity Creation">
                                    <field name="etimad_auto_create_opportunity"/>
                                    <field name="etimad_min_tender_value" invisible="not etimad_auto_create_opportunity"/>
                                    <field name="etimad_min_match_score" invisible="not etimad_auto_create_opportunity"/>
                                    <field name="etimad_auto_assign_salesperson" invisible="not etimad_auto_create_opportunity"/>
                                </group>
                                <group string="Auto Fetch Details">
                                    <field name="etimad_auto_fetch_details"/>
                                    <field name="etimad_fetch_details_threshold" invisible="not etimad_auto_fetch_details"/>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 4: Notifications -->
                        <page string="Notifications" name="notifications">
                            <group>
                                <group string="Notification Triggers">
                                    <field name="etimad_notify_new_tenders"/>
                                    <field name="etimad_notify_high_match"/>
                                    <field name="etimad_notify_hot_tenders"/>
                                    <field name="etimad_notify_urgent_deadlines"/>
                                </group>
                                <group string="Recipients">
                                    <field name="etimad_notification_user_ids" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>

                        <!-- Tab 5: Archive -->
                        <page string="Archive" name="archive">
                            <group>
                                <group string="Auto Archive">
                                    <field name="etimad_auto_archive"/>
                                    <field name="etimad_archive_days" invisible="not etimad_auto_archive"/>
                                    <field name="etimad_archive_lost_only" invisible="not etimad_auto_archive"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="action_save" string="Save" type="object" class="btn-primary"/>
                    <button string="Discard" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_etimad_config_wizard" model="ir.actions.act_window">
        <field name="name">Etimad Tenders Settings</field>
        <field name="res_model">ics.etimad.config.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <menuitem id="menu_etimad_config_smart_matching"
              name="Settings"
              parent="menu_etimad_config"
              action="action_etimad_config_wizard"
              sequence="1"
              groups="base.group_system"/>
</odoo>
